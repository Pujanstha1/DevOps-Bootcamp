# 18. Security Considerations and Best Practices

Writing secure shell scripts is essential to **prevent unauthorized access, data loss, and system compromise**.

---

## 18.1 Avoid Hardcoding Passwords
- Never store passwords directly in scripts
- Use environment variables or external config files with restricted permissions

### Example
```bash
# BAD practice
DB_PASS="mypassword"
# GOOD practice
DB_PASS="$DB_PASS"
```
- Load from environment or `.env` file: `source /home/user/.env`

---

## 18.2 Use Correct File Permissions
- Scripts should not be world-writable
```bash
chmod 700 script.sh   # Only owner can read/write/execute
chmod 600 config.env  # Only owner can read/write
```

---

## 18.3 Input Validation
- Validate user input to prevent command injection or invalid operations

### Example
```bash
read -p "Enter filename: " filename
if [[ ! $filename =~ ^[a-zA-Z0-9._-]+$ ]]; then
    echo "Invalid filename"
    exit 1
fi
```

---

## 18.4 Avoid Using sudo Inside Scripts
- Scripts should **not require elevated privileges unnecessarily**
- Run commands with `sudo` manually if needed

---

## 18.5 Use Full Paths
- Avoid relying on `$PATH` to prevent executing malicious commands
```bash
/bin/ls -l /tmp
/usr/bin/grep "error" file.txt
```

---

## 18.6 Trap Signals and Clean Up
- Ensure temporary files or sensitive data are cleaned
```bash
trap 'rm -f /tmp/tempfile; echo "Cleaned up"' EXIT
```

---

## 18.7 Disable Shell Expansion for Untrusted Input
- Quote variables properly
```bash
rm "$user_input"  # prevents rm from executing multiple unintended files
```

---

## 18.8 Practical Examples
1. Securely reading password:
```bash
read -s -p "Enter password: " DB_PASS
```
2. Validate numeric input:
```bash
read -p "Enter age: " age
if ! [[ $age =~ ^[0-9]+$ ]]; then
    echo "Invalid age"; exit 1
fi
```
3. Restrict script permissions:
```bash
chmod 700 secure_script.sh
```

---

## Summary
- **Never hardcode sensitive data**
- **Validate user input**
- **Set strict file permissions**
- **Use full paths and quote variables**
- **Trap signals and cleanup**
- Security practices prevent **script exploitation and system compromise**