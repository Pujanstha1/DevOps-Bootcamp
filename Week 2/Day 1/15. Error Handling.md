# 15. Error Handling and Robust Scripts (set -euo pipefail, Exit Codes)

Proper error handling ensures scripts **fail safely** and **provide useful feedback**.

---

## 15.1 Exit Codes
- Every command returns an exit status (`$?`)
- `0` → success
- Non-zero → error

### Example
```bash
ls /tmp        # If succeeds, $? = 0
echo $?       # Print last command exit code
ls /nonexist   # Fails, $? ≠ 0
echo $?
```

---

## 15.2 set Options
- `set -e` → exit immediately on any command failure
- `set -u` → treat unset variables as an error
- `set -o pipefail` → pipeline fails if **any command** fails, not just last

### Example
```bash
#!/bin/bash
set -euo pipefail

file=/tmp/data.txt
cat $file | grep "error"
```
- Script exits if file does not exist or grep fails

---

## 15.3 Using trap for Cleanup
```bash
#!/bin/bash
set -euo pipefail
trap 'echo "Error occurred at line $LINENO"; exit 1' ERR

# Commands that may fail
cp /nonexistent/file /tmp/
```
- `ERR` trap triggers on errors
- `$LINENO` prints the line number where error occurred

---

## 15.4 Checking Exit Status Manually
```bash
#!/bin/bash
cp file1.txt /tmp/
if [ $? -ne 0 ]; then
    echo "Copy failed"
    exit 1
fi
```
- Useful when **specific handling** is needed

---

## 15.5 Practical Examples
1. Script fails if command fails:
```bash
#!/bin/bash
set -e
mkdir /tmp/test_dir
cd /tmp/test_dir
```
2. Use pipefail to detect errors in pipeline:
```bash
#!/bin/bash
set -o pipefail
cat file.txt | grep "Linux" | sort > result.txt
```
- If `grep` fails, script exits
3. Trap error and cleanup:
```bash
#!/bin/bash
set -euo pipefail
trap 'rm -f /tmp/tempfile; echo "Cleaned up"' EXIT
```

---

## Summary
- **Exit codes** indicate command success or failure
- **set -euo pipefail** → robust error handling
- **trap ERR / EXIT** → cleanup on failure or exit
- Check `$?` for manual handling
- Robust scripts prevent **silent failures and data corr